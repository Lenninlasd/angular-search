/*! Angular search created on 03-11-2016 */
!function(){angular.module("SolrHeatmapApp",["templates-components","ui.bootstrap","rzModule","search_components","ui.router"]),angular.module("SolrHeatmapApp").config(function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$urlRouterProvider.otherwise("/search"),$stateProvider.state({name:"search",url:"/search?time&geo&text&user",component:"search",resolve:{search:function($stateParams,HeatMapSourceGenerator,searchFilter){searchFilter.setFilter($stateParams)}}})})}(),function(){angular.module("search_cardwrapper_component",[]).directive("cardWrapper",function(){return{scope:{},transclude:!0,template:'<div class="row component-padding"><div class="col-xs-12 row-box"><ng-transclude></ng-transclude></div></div>'}})}(),function(){angular.module("search_datepicker_component",[]).directive("datePicker",["HeatMapSourceGenerator","InfoService","searchFilter","DateTimeService",function(HeatMapSourceGenerator,InfoService,searchFilter,DateTimeService){function datePickerFilterLink(scope){function openStartDate(){vm.startDate.opened=!0,vm.dateOptions.minDate=vm.initialDateOptions.minDate,vm.dateOptions.maxDate=vm.datepickerEndDate}function openEndDate(){vm.endDate.opened=!0,vm.dateOptions.maxDate=vm.initialDateOptions.maxDate,vm.dateOptions.minDate=vm.datepickerStartDate}function onChangeDatepicker(){vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),performDateSearch()}function stringToStartEndDateArray(dateString){if(!angular.isString(dateString))return null;var dateArray=dateString.split(" TO ");return angular.isString(dateString)&&2===dateArray.length?(dateArray[0]=new Date(dateArray[0].slice(1,11)),dateArray[1]=new Date(dateArray[1].slice(0,10)),"Invalid Date"===dateArray[0]||"Invalid Date"===dateArray[0]?null:dateArray):null}function changeDatepicker(){var dateArray=stringToStartEndDateArray(vm.dateString);return null!==dateArray?(vm.datepickerStartDate=dateArray[0],vm.datepickerEndDate=dateArray[1],!0):(vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),!1)}function onSubmitDateText(){var hasDatepickerChanged=changeDatepicker();hasDatepickerChanged&&performDateSearch()}function showDatepickerInfo(){InfoService.showInfoPopup("datepicker")}function performDateSearch(){searchFilter.time=vm.dateString,HeatMapSourceGenerator.search()}var vm=scope;vm.initialDateOptions={minDate:new Date("2013-03-01"),maxDate:new Date("2013-04-01")},vm.dateOptions=searchFilter,vm.dateOptions.startingDate=1,vm.dateOptions.showWeeks=!1,vm.$watch(function(){return vm.dateOptions.time},function(newValue,oldValue){angular.isString(newValue)&&(vm.dateString=newValue,changeDatepicker())}),vm.startDate={opened:!1},vm.endDate={opened:!1},vm.datepickerStartDate=vm.dateOptions.minDate,vm.datepickerEndDate=vm.dateOptions.maxDate,vm.onChangeDatepicker=onChangeDatepicker,vm.showDatepickerInfo=showDatepickerInfo,vm.openEndDate=openEndDate,vm.openStartDate=openStartDate,vm.onSubmitDateText=onSubmitDateText}return{link:datePickerFilterLink,templateUrl:"components/datepicker/datepicker.tpl.html",restrict:"EA",scope:{}}}])}(),function(){angular.module("search_geospatialFilter_component",[]).directive("geospatialFilter",["InfoService","searchFilter","HeatMapSourceGenerator","Map",function(InfoService,searchFilter,HeatMapSourceGenerator,Map){function GeospatialFilterLink(scope){scope.filter=searchFilter,scope.showGeospatialInfo=function(){InfoService.showInfoPopup("geospatialsearch")},scope.updateFilterString=function(str){scope.filter.geo=str},scope.search=function(){Map.updateTransformationLayerFromQueryForMap(this.filter.geo),HeatMapSourceGenerator.search()}}return{link:GeospatialFilterLink,restrict:"EA",templateUrl:"components/geospatialFilter/geospatialFilter.tpl.html",scope:{}}}])}(),function(){function heatmap(){return{restrict:"EA",templateUrl:"components/heatmap/heatmap.tpl.html",scope:{}}}angular.module("search_heatmap_component",[]).directive("heatmap",heatmap)}(),function(){angular.module("search_timehistogram_component",[]).directive("timeHistogram",["$rootScope","HeatMapSourceGenerator","searchFilter","DateTimeService",function($rootScope,HeatMapSourceGenerator,searchFilter,DateTimeService){function link(scope,element,attr){function makeHistogram(histogram){function findHistogramMaxValue(){histogram.maxValue=Math.max.apply(null,histogram.counts.map(function(obj){return obj.count}))}function renderingSvgBars(minValue,maxValue){function renderSvgBar(bar,barKey){var height=0===histogram.maxValue?0:barsheight*bar.count/histogram.maxValue,y=barsheight-height,translate=rectWidth*barKey,color=getColor(barKey,minValue,maxValue);return'<g transform="translate('+translate+', 0)">  <rect width="'+rectWidth+'" height="'+height+'" y="'+y+'" fill="'+color+'"></rect></g>'}function getColor(barkey,minvalue,maxvalue){return barkey>=minvalue&&barkey<=maxvalue?"#88b5dd":"#E3E3E3"}if(histogram.counts){minValue=minValue||0,maxValue=maxValue||histogram.counts.length-1,histogram.bars=document.getElementById(scope.barId);var rectWidth=histogrambarsWidth/histogram.counts.length,svgRect=histogram.counts.map(renderSvgBar);histogram.bars.innerHTML='<svg width="100%" height="'+barsheight+'">'+svgRect.join("")+"</svg>"}}var barsheight=40,histogrambarsWidth=364;return findHistogramMaxValue(),renderingSvgBars}function setHistogram(event,dataHistogram){return dataHistogram.counts.length?(disableSlider(!1),void(1===vm.slider.options.ceil||isTheInitialDate()||dataHistogram.counts.length-1>vm.slider.options.ceil?(vm.slider.counts=dataHistogram.counts,vm.slider.options.ceil=dataHistogram.counts.length-1,vm.slider.maxValue=vm.slider.options.ceil,vm.slider.minValue=0,dataHistogram.slider=vm.slider,$rootScope.$broadcast("setHistogramRangeSlider",dataHistogram)):(vm.slider.changeTime=!1,$rootScope.$broadcast("changeSlider",vm.slider)))):void disableSlider(!0)}function isTheInitialDate(){var initialDate=DateTimeService.formatDatesToString(searchFilter.minDate,searchFilter.maxDate);return initialDate===searchFilter.time}function slideEnded(){var minKey=vm.slider.minValue,maxKey=vm.slider.maxValue;vm.datepickerStartDate=new Date(vm.slider.counts[minKey].value),vm.datepickerEndDate=new Date(vm.slider.counts[maxKey].value),vm.dateString=DateTimeService.formatDatesToString(vm.datepickerStartDate,vm.datepickerEndDate),performDateSearch()}function performDateSearch(){vm.slider.changeTime=!0,searchFilter.time=vm.dateString,HeatMapSourceGenerator.search()}function disableSlider(option){option?(vm.slider.options.disabled=!0,vm.slider.options.getSelectionBarColor=function(){return"#e3e3e3"}):(vm.slider.options.disabled=!1,vm.slider.options.getSelectionBarColor=defaultSliderValue().options.getSelectionBarColor)}function defaultSliderValue(){return{minValue:0,maxValue:1,changeTime:!1,options:{floor:0,ceil:1,step:1,minRange:1,noSwitching:!0,hideLimitLabels:!0,getSelectionBarColor:function(){return"#609dd2"},translate:function(){return""}}}}var renderSvgBars,vm=scope;scope.barId=attr.barid,scope.slider=defaultSliderValue(),scope.$on("setHistogramRangeSlider",function(even,histogram){(renderSvgBars=makeHistogram(histogram))()}),scope.$on("changeSlider",function(event,slider){renderSvgBars(slider.minValue,slider.maxValue)}),scope.$on("setHistogram",setHistogram),scope.$on("slideEnded",slideEnded)}var directive={templateUrl:"components/histogram/histogram.tpl.html",restrict:"EA",link:link,scope:{}};return directive}])}(),function(){angular.module("search_keyword_component",[]).directive("keyword",function(){function keywordLink(scope){var vm=scope;vm.removeTag="true"===vm.remove}return{scope:{tag:"@",remove:"@",removefn:"&"},link:keywordLink,templateUrl:"components/keyword/keyword.tpl.html"}})}(),function(){angular.module("search_keywordinput_component",[]).directive("keywordInput",["HeatMapSourceGenerator","searchFilter","$window","filterKeywordService",function(HeatMapSourceGenerator,searchFilter,$window,filterKeywordService){function keywordInputLink(scope){function getKeyboardCodeFromEvent(keyEvt){return $window.event?keyEvt.keyCode:keyEvt.which}function onKeyPress($event){13===getKeyboardCodeFromEvent($event)?vm.doSearch():8===getKeyboardCodeFromEvent($event)&&removeKeyWordFromDeleteKey()}function doSearch(){vm.textSearchInput.value.length&&(vm.filter[vm.text]=concatSearchInput(vm.filter[vm.text],vm.textSearchInput.value),vm.textSearchInput={value:"",previousLength:0}),HeatMapSourceGenerator.search()}function concatSearchInput(searchInput,newValue){if(searchInput&&""!==searchInput){var keywordslength=searchInput.split('"="').length;if(1===keywordslength)return'"'+searchInput+'" "'+newValue+'"';if(keywordslength>1)return searchInput+' "'+newValue+'"'}return""===newValue?null:newValue}function keyWordStringToArray(keyWordString){return keyWordString=keyWordString||"",keyWordString.split('"').filter(function(val){return""!==val&&" "!==val})}function removeKeyWord(keyword){var fiterText;vm.filterArray.forEach(function(value){if(value!==keyword)return void(fiterText=concatSearchInput(fiterText,value))}),vm.filter[vm.text]=fiterText,HeatMapSourceGenerator.search()}function removeKeyWordFromDeleteKey(){""===vm.textSearchInput.value&&0===vm.textSearchInput.previousLength&&removeKeyWord(vm.filterArray.pop()),vm.textSearchInput.previousLength=vm.textSearchInput.value.length}function addSuggestedKeywordToSearchInput(keyword){vm.textSearchInput.value=keyword,doSearch()}function listenSuggestWords(){vm.$on(vm.listenKeywordEvent,function(event,dataRawKeywords){angular.isArray(dataRawKeywords)||(dataRawKeywords=[]),vm.tagSwitch.disable=!1,vm.suggestedKeywords=dataRawKeywords.filter(filterKeywordService.filter)})}function toggleSuggestKeywords(){vm.limit&&(vm.filter[vm.limit]=vm.tagSwitch.value?numberKeywords:null,vm.tagSwitch.disable=!0,HeatMapSourceGenerator.search())}var vm=scope,numberKeywords=vm.numberKeywords||5;vm.filter=searchFilter,vm.filterArray=[],vm.suggestedKeywords=[],vm.textSearchInput={value:"",previousLength:0},vm.focus=!1,vm.tagSwitch={value:!1,disable:!1},vm.doSearch=doSearch,vm.removeKeyWord=removeKeyWord,vm.addSuggestedKeywordToSearchInput=addSuggestedKeywordToSearchInput,vm.onKeyPress=onKeyPress,vm.toggleSuggestKeywords=toggleSuggestKeywords,listenSuggestWords(),vm.$watch(function(){return vm.filter[vm.text]},function(newValue,oldValue){vm.filterArray=keyWordStringToArray(newValue)})}return{link:keywordInputLink,restrict:"EA",templateUrl:"components/keywordInput/keywordInput.tpl.html",scope:{listenKeywordEvent:"@",numberKeywords:"=",limit:"@",text:"@",placeholder:"@"}}}])}(),function(){angular.module("search_components",["search_timehistogram_component","search_datepicker_component","search_tweetlist_component","search_tweetpanel_component","search_tweetcounter_component","search_toolbarsearch_component","search_userFilter_component","search_geospatialFilter_component","search_resetButton_component","search_heatmap_component","search_keyword_component","search_cardwrapper_component","search_keywordinput_component"])}(),function(){angular.module("search_resetButton_component",[]).directive("resetButton",["HeatMapSourceGenerator","searchFilter","Map",function(HeatMapSourceGenerator,searchFilter,Map){function ExportLink(scope){scope.reset=function(){Map.resetMap(),searchFilter.resetFilter(),HeatMapSourceGenerator.search()}}return{link:ExportLink,restrict:"EA",templateUrl:"components/resetButton/resetButton.tpl.html",scope:{}}}])}(),angular.module("SolrHeatmapApp").component("search",function(){}),function(){angular.module("search_toolbarsearch_component",[]).directive("toolbarSearch",[function(){return{restrict:"EA",template:'<keyword-input number-keywords="15" text="text" limit="textLimit"listen-keyword-event="setSuggestWords" placeholder="Enter keyword"></keyword-input>',scope:{}}}])}(),function(){angular.module("search_tweetcounter_component",[]).directive("tweetCounter",[function(){function tweetCounterLink(scope){scope.$on("setCounter",function(e,data){(data<1||!data)&&(data="No results found"),scope.counter=data})}return{link:tweetCounterLink,restrict:"EA",templateUrl:"components/tweetlist/counter.tpl.html",scope:{}}}])}(),function(){angular.module("search_tweetpanel_component",[]).directive("tweetPanel",["PanelInformationService",function(PanelInformationService){function tweetPanelLink(scope){function IsPanelEmpty(){return 0===Object.keys(vm.selectedTweet).length}var vm=scope;vm.selectedTweet=PanelInformationService.selectedTweet,vm.panelEmpty=!0,vm.$watch(function(){return PanelInformationService.selectedTweet},function(newValue,oldValue){vm.selectedTweet=newValue,vm.panelEmpty=IsPanelEmpty()})}return{link:tweetPanelLink,restrict:"EA",templateUrl:"components/tweetlist/tweetPanel.tpl.html",scope:{}}}])}(),function(){angular.module("search_tweetlist_component",[]).directive("tweetlist",["Map","HeightModule","PanelInformationService",function(Map,HeightModule,PanelInformationService){function tweetlistLink(scope){function setTweetList(event,tweetList){vm.tweetList=tweetList?tweetList:[],vm.tweetList.exist=!0,vm.availableHeight=HeightModule.availableHeight()}function selectTweet(tweet){PanelInformationService.selectedTweet=tweet,addCircle(tweet.coord)}function addCircle(coordinates){var coordArray;angular.isString(coordinates)&&coordinates.includes(",")&&(coordArray=coordinates.split(",").map(function(val){return Number(val)}),MapService.addCircle([coordArray[1],coordArray[0]],stylePoint))}var vm=scope;vm.tweetList=[],vm.tweetList.exist=!1,vm.selectTweet=selectTweet,vm.removeAllfeatures=MapService.removeAllfeatures,vm.availableHeight=HeightModule.availableHeight(),vm.$on("setTweetList",setTweetList);var stylePoint=new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:"rgba(0,0,255,0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0,0,255,0.9)",width:2})})})}var MapService=Map;return{link:tweetlistLink,restrict:"EA",templateUrl:"components/tweetlist/tweetlist.tpl.html",scope:{}}}])}(),function(){angular.module("search_userFilter_component",[]).directive("userFilter",[function(){return{restrict:"EA",template:'<keyword-input number-keywords="5" text="user" limit="userLimit"listen-keyword-event="setUserSuggestWords" placeholder="@user"></keyword-input>',scope:{}}}])}(),function(){angular.module("SolrHeatmapApp").controller("BackgroundLayerController",["MapService","$scope",function(MapService,$scope){var vm=this;vm.layers={},vm.selectedLayer={},vm.$on("mapReady",function(event,map){vm.layers=map.getLayers().getArray(),vm.selectedLayer={name:vm.getBackgroundLayers()[0].get("name")}}),vm.isBackgroundLayer=function(layer){var isBackgroundLayer=!1;return layer.get("backgroundLayer")&&(isBackgroundLayer=!0),isBackgroundLayer},vm.setBackgroundLayer=function(layer){angular.forEach(vm.getBackgroundLayers(),function(bgLayer){bgLayer===layer?(layer.setVisible(!0),vm.selectedLayer={name:layer.get("name")}):bgLayer.setVisible(!1)})},vm.getBackgroundLayers=function(){var layers=MapService.getMap().getLayers().getArray();return layers.filter(function(l){return!!l.get("backgroundLayer")})}}])}(),function(){angular.module("SolrHeatmapApp").controller("InfoWindowController",function($scope,$uibModalInstance,infoMsg,toolName){$scope.infoMsg=infoMsg,$scope.toolName=toolName,$scope.ok=function(){$uibModalInstance.close()}})}(),function(){angular.module("SolrHeatmapApp").controller("MainController",["Map","HeatMapSourceGenerator","$http","$scope","$rootScope","$stateParams","searchFilter","queryService",function(Map,HeatMapSourceGenerator,$http,$scope,$rootScope,$stateParams,searchFilter,queryService){var MapService=Map,HeatMapSourceGeneratorService=HeatMapSourceGenerator,vm=this;vm.$state=$stateParams,vm.setupEvents=function(){MapService.getMap().getView().on("change:resolution",function(evt){var existingHeatMapLayers=MapService.getLayersBy("name","HeatMapLayer");if(existingHeatMapLayers&&existingHeatMapLayers.length>0){var radius=500*evt.target.getResolution(),hmLayer=existingHeatMapLayers[0];radius>15&&(radius=15),hmLayer.setRadius(radius),hmLayer.setBlur(2*radius)}MapService.checkBoxOfTransformInteraction()}),MapService.getMap().on("moveend",function(evt){MapService.checkBoxOfTransformInteraction();var currentExtent=MapService.getCurrentExtentQuery();searchFilter.setFilter({geo:currentExtent.geo,hm:currentExtent.hm}),HeatMapSourceGeneratorService.search()})},vm.response=function(data,status,headers,config){if(!data||!data.mapConfig)throw new Error("Could not find the mapConfig");var mapConf=data.mapConfig,appConf=data.appConfig,bopwsConfig=data.bopwsConfig,instructions=data.instructions;solrHeatmapApp.$state.geo&&(mapConf.view.initExtent=mapConf.view.extent,mapConf.view.extent=queryService.getExtentForProjectionFromQuery(solrHeatmapApp.$state.geo,mapConf.view.projection)),MapService.init({mapConfig:mapConf}),solrHeatmapApp.appConfig=appConf,solrHeatmapApp.initMapConf=mapConf,solrHeatmapApp.bopwsConfig=bopwsConfig,solrHeatmapApp.instructions=instructions,$rootScope.$broadcast("mapReady",MapService.getMap()),solrHeatmapApp.setupEvents()},vm.badResponse=function(data,status,headers,config){throw new Error("Error while loading the config.json")},solrHeatmapApp=vm,$http.get("./config/appConfig.json").success(solrHeatmapApp.response).error(solrHeatmapApp.badResponse)}])}(),function(){angular.module("SolrHeatmapApp").factory("DateTimeService",[function(){function formatDatesToString(minDate,maxDate){return"["+minDate.toISOString().replace(".000Z","")+" TO "+maxDate.toISOString().replace(".000Z","")+"]"}var service={formatDatesToString:formatDatesToString};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("filterKeywordService",[function(){function filter(keywordObj){return keywordObj.value.length>=3&&!iskeywordInTheBlacklist(keywordObj.value)}function iskeywordInTheBlacklist(comparedWord){var blacklist=["i","to","the","a","you","my","t.co","http","now","know","good","we","it's"],comparedList=blacklist.filter(function(blackWord){return blackWord===comparedWord});return 0!==comparedList.length}return{filter:filter}}])}(),function(){angular.module("SolrHeatmapApp").factory("HeatMapSourceGenerator",["Map","$rootScope","$controller","$filter","$window","$document","$http","$state","searchFilter","DateTimeService",function(Map,$rootScope,$controller,$filter,$window,$document,$http,$state,searchFilter,DateTimeService){function getTweetsSearchQueryParameters(bounds){var params,reqParamsUi=searchFilter;return params={"q.text":reqParamsUi.text,"q.user":reqParamsUi.user,"q.time":timeTextFormat(reqParamsUi.time,reqParamsUi.minDate,reqParamsUi.maxDate),"q.geo":reqParamsUi.geo,"a.hm.filter":reqParamsUi.hm,"a.time.limit":"1","a.time.gap":"PT1H","d.docs.limit":reqParamsUi.numOfDocs,"a.text.limit":reqParamsUi.textLimit,"a.user.limit":reqParamsUi.userLimit},$state.go("search",{text:params["q.text"],user:params["q.user"],time:params["q.time"],geo:params["q.geo"]},{notify:!1,location:"replace"}),params}function search(){var config,params=createParamsForGeospatialSearch();params?(params["a.hm.limit"]=solrHeatmapApp.bopwsConfig.heatmapFacetLimit,config={url:solrHeatmapApp.appConfig.tweetsSearchBaseUrl,method:"GET",params:params},$http(config).then(function(response){var data=response.data;data["a.text"]=data["a.text"]||[],data&&data["a.hm"]&&(MapService.createOrUpdateHeatMapLayer(data["a.hm"]),$rootScope.$broadcast("setCounter",data["a.matchDocs"]),$rootScope.$broadcast("setHistogram",data["a.time"]),$rootScope.$broadcast("setTweetList",data["d.docs"]),$rootScope.$broadcast("setSuggestWords",data["a.text"]),$rootScope.$broadcast("setUserSuggestWords",data["a.user"]),searchFilter.histogramCount=data["a.time"].counts)},function(response){$window.alert("An error occured while reading heatmap data")})["catch"](function(){$window.alert("An error occured while reading heatmap data")})):$window.alert("Spatial filter could not be computed.")}function timeTextFormat(textDate,minDate,maxDate){return null===textDate?DateTimeService.formatDatesToString(minDate,maxDate):textDate}var MapService=Map,methods={search:search},createParamsForGeospatialSearch=function(){return getTweetsSearchQueryParameters()};return methods}])}(),function(){angular.module("SolrHeatmapApp").factory("HeightModule",["$window",function($window){function documentHeight(){var D=document;return Math.max(D.body.offsetHeight,D.documentElement.offsetHeight,D.body.clientHeight,D.documentElement.clientHeight)}function availableHeight(){return documentHeight()-service.otherHeights}function calculateNumberofItems(){var height=availableHeight();return height>0?Math.round(height/service.itemHeight):10}var service={itemHeight:90,otherHeights:330,sideBarWidth:400,rightSideBarWidth:4,bottomHeight:8,topPanelHeight:105,documentHeight:documentHeight,availableHeight:availableHeight,getNumberofItems:calculateNumberofItems};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("InfoService",["$uibModal",function($uibModal){function showInfoPopup(instructionsKey){var instructionTopic=solrHeatmapApp.instructions[instructionsKey];if(instructionTopic){$uibModal.open({animation:!0,templateUrl:"infoPopup.html",controller:"InfoWindowController",size:"lg",resolve:{infoMsg:function(){return instructionTopic.instruction},toolName:function(){return instructionTopic.toolTitle}}})}}return{showInfoPopup:showInfoPopup}}])}(),function(){angular.module("SolrHeatmapApp").factory("Map",["$rootScope","$filter","$document","Normalize","$controller","queryService","HeightModule","$window",function($rootScope,$filter,$document,Normalize,$controller,queryService,HeightModule,$window){function buildMapLayers(layerConfig){var layer,layers=[];return angular.isArray(layerConfig)&&angular.forEach(layerConfig,function(conf){"TileWMS"===conf.type&&(layer=new ol.layer.Tile({name:conf.name,backgroundLayer:conf.backgroundLayer,displayInLayerPanel:conf.displayInLayerPanel,source:new ol.source.TileWMS({attributions:[new ol.Attribution({html:conf.attribution})],crossOrigin:conf.crossOrigin,logo:conf.logo,params:conf.params,ratio:conf.ratio,resolutions:conf.resoltions,url:conf.url}),opacity:conf.opacity,visible:conf.visible})),"ImageWMS"===conf.type&&(layer=new ol.layer.Image({name:conf.name,backgroundLayer:conf.backgroundLayer,displayInLayerPanel:conf.displayInLayerPanel,source:new ol.source.ImageWMS({attributions:[new ol.Attribution({html:conf.attribution})],crossOrigin:conf.crossOrigin,logo:conf.logo,params:conf.params,resolutions:conf.resoltions,url:conf.url}),opacity:conf.opacity,visible:conf.visible})),layers.push(layer)}),layers}function heatmapMinMax(heatmap,stepsLatitude,stepsLongitude){for(var max=-1,min=Number.MAX_VALUE,i=0;i<stepsLatitude;i++){var currentRow=heatmap[i];null===currentRow&&(heatmap[i]=currentRow=[]);for(var j=0;j<stepsLongitude;j++)null===currentRow[j]&&(currentRow[j]=-1),currentRow[j]>max&&(max=currentRow[j]),currentRow[j]<min&&currentRow[j]>-1&&(min=currentRow[j])}return[min,max]}function rescaleHeatmapValue(value,minMaxValue){return null===value?0:value===-1?-1:0===value?0:minMaxValue[1]-minMaxValue[0]===0?0:(value-minMaxValue[0])/(minMaxValue[1]-minMaxValue[0])}function createHeatMapSource(hmParams){var minMaxValue,olVecSrc,counts_ints2D=hmParams.counts_ints2D,gridColumns=(hmParams.gridLevel,hmParams.columns),gridRows=hmParams.rows,minX=hmParams.minX,minY=hmParams.minY,maxX=hmParams.maxX,maxY=hmParams.maxY,hmProjection=hmParams.projection,dx=maxX-minX,dy=maxY-minY,sx=dx/gridColumns,sy=dy/gridRows,olFeatures=[];if(!counts_ints2D)return null;minMaxValue=heatmapMinMax(counts_ints2D,gridRows,gridColumns);for(var i=0;i<gridRows;i++)for(var j=0;j<gridColumns;j++){var lon,lat,feat,coords,hmVal=counts_ints2D[counts_ints2D.length-i-1][j];if(hmVal&&null!==hmVal){lat=minY+i*sy+.5*sy,lon=minX+j*sx+.5*sx,coords=ol.proj.transform([lon,lat],hmProjection,map.getView().getProjection().getCode()),feat=new ol.Feature({geometry:new ol.geom.Point(coords)});var scaledValue=rescaleHeatmapValue(hmVal,minMaxValue);feat.set("weight",scaledValue),feat.set("origVal",hmVal),olFeatures.push(feat)}}return olVecSrc=new ol.source.Vector({features:olFeatures,useSpatialIndex:!0})}function generateMaskAndAssociatedInteraction(bboxFeature,fromSrs){var polygon=new ol.Feature(ol.geom.Polygon.fromExtent(bboxFeature)),backGroundLayer=service.getLayersBy("backgroundLayer",!0)[0];if(fromSrs!==service.getMapProjection()){var polygonNew=ol.proj.transformExtent(bboxFeature,fromSrs,service.getMapProjection());polygon=new ol.Feature(ol.geom.Polygon.fromExtent(polygonNew))}var vector=new ol.layer.Vector({name:"TransformInteractionLayer",source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:[255,255,255,.01]})})});service.getMap().addLayer(vector),vector.getSource().addFeature(polygon);var mask=new ol.filter.Mask({feature:polygon,inner:!1,fill:new ol.style.Fill({color:[255,255,255,.5]})});backGroundLayer.addFilter(mask)}function setTransactionBBox(extent){var polyNew,transformationLayer=service.getLayersBy("name","TransformInteractionLayer")[0],vectorSrc=transformationLayer.getSource(),currentBbox=vectorSrc.getFeatures()[0];polyNew=ol.geom.Polygon.fromExtent(extent),currentBbox.setGeometry(polyNew)}var NormalizeService=Normalize,service={},map={},defaults={renderer:"canvas",view:{center:[0,0],projection:"EPSG:3857",zoom:2}};service.getMap=function(){return map},service.getMapView=function(){return service.getMap().getView()},service.getMapZoom=function(){return service.getMapView().getZoom()},service.getMapSize=function(){return service.getMap().getSize()},service.getMapProjection=function(){return service.getMapView().getProjection().getCode()},service.getLayers=function(){return service.getMap().getLayers().getArray()},service.getInteractions=function(){return service.getMap().getInteractions().getArray()},service.getLayersBy=function(key,value){var layers=service.getLayers();return $filter("filter")(layers,function(layer){return layer.get(key)===value})},service.getInteractionsByClass=function(value){var interactions=service.getInteractions();return $filter("filter")(interactions,function(interaction){return interaction instanceof value})},service.getInteractionsByType=function(interactions,type){return $filter("filter")(interactions,function(interaction){return interaction.type_===type})},service.updateTransformationLayerFromQueryForMap=function(query){var extent=queryService.getExtentForProjectionFromQuery(query,service.getMapProjection());setTransactionBBox(extent)};var _switchMasks=function(hmAvailable){var heatMapLayer=service.getLayersBy("name","HeatMapLayer")[0],heatMapMask=heatMapLayer.getFilters()[0],backgroundLayer=service.getLayersBy("backgroundLayer",!0)[0],backgroundLayerMask=backgroundLayer.getFilters()[0];backgroundLayerMask.setActive(!hmAvailable),heatMapMask.setActive(hmAvailable)};return service.createOrUpdateHeatMapLayer=function(data){var existingHeatMapLayers,transformInteractionLayer,olVecSrc,newHeatMapLayer;if(existingHeatMapLayers=service.getLayersBy("name","HeatMapLayer"),transformInteractionLayer=service.getLayersBy("name","TransformInteractionLayer")[0],olVecSrc=createHeatMapSource(data),existingHeatMapLayers&&existingHeatMapLayers.length>0){var currHeatmapLayer=existingHeatMapLayers[0],layerSrc=currHeatmapLayer.getSource();layerSrc&&layerSrc.clear(),currHeatmapLayer.setSource(olVecSrc)}else{newHeatMapLayer=new ol.layer.Heatmap({name:"HeatMapLayer",source:olVecSrc,radius:10}),service.getMap().addLayer(newHeatMapLayer);var currentBBox=transformInteractionLayer.getSource().getFeatures()[0],mask=new ol.filter.Mask({feature:currentBBox,inner:!1,fill:new ol.style.Fill({color:[255,255,255,.5]})});newHeatMapLayer.addFilter(mask)}_switchMasks(null!==olVecSrc)},service.calculateReducedBoundingBoxFromInFullScreen=function(extent){var sideBarPercent=1-HeightModule.sideBarWidth/$window.innerWidth,rightSideBarWidth=1-HeightModule.rightSideBarWidth/$window.innerWidth,bottomHeight=1-HeightModule.bottomHeight/$window.innerWidth,topBarPercent=1-HeightModule.topPanelHeight/HeightModule.documentHeight();if(solrHeatmapApp.appConfig){var dx=extent.maxX-extent.minX,dy=extent.maxY-extent.minY,minX=extent.minX+(1-sideBarPercent)*dx,maxX=extent.minX+rightSideBarWidth*dx,minY=extent.minY+(1-bottomHeight)*dy,maxY=extent.minY+topBarPercent*dy;return{minX:minX,minY:minY,maxX:maxX,maxY:maxY}}return extent},service.checkBoxOfTransformInteraction=function(){var mapExtent=service.getMapView().calculateExtent(service.getMapSize()),reducedBoundingBox=service.calculateReducedBoundingBoxFromInFullScreen({minX:mapExtent[0],minY:mapExtent[1],maxX:mapExtent[2],maxY:mapExtent[3]});setTransactionBBox([reducedBoundingBox.minX,reducedBoundingBox.minY,reducedBoundingBox.maxX,reducedBoundingBox.maxY])},service.resetMap=function(){var intitalCenter=solrHeatmapApp.initMapConf.view.center,intitalZoom=solrHeatmapApp.initMapConf.view.zoom;if(intitalZoom&&intitalCenter){var vw=service.getMapView();vw.setCenter(intitalCenter),vw.setZoom(intitalZoom),service.checkBoxOfTransformInteraction()}},service.getReducedQueryFromExtent=function(extentQuery){var extent=queryService.getExtentFromQuery(extentQuery);return queryService.createQueryFromExtent(service.calculateReducedBoundingBoxFromInFullScreen(extent))},service.getCurrentExtentQuery=function(){var currentExtent=service.getCurrentExtent();return{geo:queryService.createQueryFromExtent(currentExtent.geo),hm:queryService.createQueryFromExtent(currentExtent.hm)}},service.getCurrentExtent=function(){function createExtent(normalizedExtent){return{minX:normalizedExtent[1],maxX:normalizedExtent[3],minY:normalizedExtent[0],maxY:normalizedExtent[2]}}var currentBbox,currentBboxExtentWgs84,viewProj=service.getMapProjection(),extent=service.getMapView().calculateExtent(service.getMapSize()),extentWgs84=ol.proj.transformExtent(extent,viewProj,"EPSG:4326"),transformInteractionLayer=service.getLayersBy("name","TransformInteractionLayer")[0],currentExtent={},currentExtentBox={};if(!transformInteractionLayer)return null;if(currentBbox=transformInteractionLayer.getSource().getFeatures()[0],currentBboxExtentWgs84=ol.proj.transformExtent(currentBbox.getGeometry().getExtent(),viewProj,"EPSG:4326"),service.getMapZoom()<=1&&(extentWgs84=[-180,-90,180,90]),extent&&extentWgs84){var normalizedExtentMap=NormalizeService.normalizeExtent(extentWgs84),normalizedExtentBox=NormalizeService.normalizeExtent(currentBboxExtentWgs84);currentExtent=createExtent(normalizedExtentMap),currentExtentBox=createExtent(normalizedExtentBox);var roundToFixed=function(value){return parseFloat(Math.round(100*value)/100).toFixed(2)};$rootScope.$broadcast("geoFilterUpdated","["+roundToFixed(currentExtentBox.minX)+","+roundToFixed(currentExtentBox.minY)+" TO "+roundToFixed(currentExtentBox.maxX)+","+roundToFixed(currentExtentBox.maxY)+"]")}return{hm:currentExtent,geo:currentExtentBox}},service.removeAllfeatures=function(){if(angular.isObject(map))for(var layerLength=map.getLayers().getLength(),i=3;i<layerLength;i++)map.removeLayer(map.getLayers().getArray()[i])},service.addCircle=function(point,style){service.removeAllfeatures();var geojsonObject={type:"Feature",geometry:{type:"Point",coordinates:ol.proj.fromLonLat(point)}};if(angular.isObject(map)&&0!==Object.keys(map).length){var vectorLayer=new ol.layer.Vector({source:new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(geojsonObject)})});vectorLayer.setStyle(style),map.addLayer(vectorLayer)}},service.init=function(config){var viewConfig=angular.extend(defaults.view,config.mapConfig.view),rendererConfig=config.mapConfig.renderer?config.mapConfig.renderer:defaults.renderer,layerConfig=config.mapConfig.layers;if(map=new ol.Map({controls:ol.control.defaults().extend([new ol.control.ScaleLine,new ol.control.ZoomSlider]),layers:buildMapLayers(layerConfig),renderer:angular.isString(rendererConfig)?rendererConfig:void 0,target:"map",view:new ol.View({
center:angular.isArray(viewConfig.center)?viewConfig.center:void 0,maxZoom:angular.isNumber(viewConfig.maxZoom)?viewConfig.maxZoom:void 0,minZoom:angular.isNumber(viewConfig.minZoom)?viewConfig.minZoom:void 0,projection:angular.isString(viewConfig.projection)?viewConfig.projection:void 0,resolution:angular.isString(viewConfig.resolution)?viewConfig.resolution:void 0,resolutions:angular.isArray(viewConfig.resolutions)?viewConfig.resolutions:void 0,rotation:angular.isNumber(viewConfig.rotation)?viewConfig.rotation:void 0,zoom:angular.isNumber(viewConfig.zoom)?viewConfig.zoom:void 0,zoomFactor:angular.isNumber(viewConfig.zoomFactor)?viewConfig.zoomFactor:void 0})}),angular.isArray(viewConfig.extent)){var vw=map.getView();vw.set("extent",viewConfig.extent),generateMaskAndAssociatedInteraction(viewConfig.extent,viewConfig.projection),viewConfig.initExtent&&vw.fit(viewConfig.extent,service.getMapSize())}},service}])}(),function(){angular.module("SolrHeatmapApp").factory("Normalize",function(){function clamp(num,min,max){if(max<min){var tmp=min;min=max,max=tmp}return Math.min(Math.max(min,num),max)}function outsideLonRange(lon){return lon<-180||lon>180}function outsideLatRange(lat){return lat<-90||lat>90}function clampLon(lon){return clamp(lon,-180,180)}function clampLat(lat){return clamp(lat,-90,90)}function normalize(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],width=Math.min(maxX-minX,360),height=Math.min(maxY-minY,180),rangeCheck=function(min,max,rangeFunc,clampFunc,extra){return rangeFunc(min)?(min=clampFunc(min),max=min+extra):rangeFunc(max)&&(max=clampFunc(max),min=max-extra),[min,max]},x=rangeCheck(minX,maxX,outsideLonRange,clampLon,width);minX=x[0],maxX=x[1];var y=rangeCheck(minY,maxY,outsideLatRange,clampLat,height);return minY=y[0],maxY=y[1],[minX,minY,maxX,maxY]}return{normalizeExtent:normalize}})}(),function(){angular.module("SolrHeatmapApp").factory("PanelInformationService",[function(){var service={selectedTweet:{}};return service}])}(),function(){angular.module("SolrHeatmapApp").factory("queryService",["Normalize",function(Normalize){var service={};return service.createQueryFromExtent=function(extent){return"["+extent.minX+","+extent.minY+" TO "+extent.maxX+","+extent.maxY+"]"},service.getExtentFromQuery=function(query){var extent,min,max,extentSplit=function(extentString){return extentString.split(",")};return extent=query.replace(/\[|\]/g,"").split(" TO "),min=extentSplit(extent[0]),max=extentSplit(extent[1]),{minX:parseInt(min[0],10),minY:parseInt(min[1],10),maxX:parseInt(max[0],10),maxY:parseInt(max[1],10)}},service.getExtentForProjectionFromQuery=function(query,projection){var extentObj=service.getExtentFromQuery(query),extent=Normalize.normalizeExtent([extentObj.minY,extentObj.minX,extentObj.maxY,extentObj.maxX]);return ol.proj.transformExtent(extent,"EPSG:4326",projection)},service}])}(),function(){angular.module("SolrHeatmapApp").factory("searchFilter",["Map","HeightModule",function(Map,HeightModule){var MapService=Map,service={geo:"[-90,-180 TO 90,180]",hm:"[-90,-180 TO 90,180]",time:null,text:null,user:null,histogramCount:[],textLimit:null,userLimit:null,numOfDocs:50,minDate:new Date("2013-03-10"),maxDate:new Date("2013-03-21")};return service.setFilter=function(filter){filter.time&&(service.time=filter.time),filter.user&&(service.user=filter.user),filter.text&&(service.text=filter.text),filter.geo&&(service.geo=filter.geo),filter.hm&&(service.hm=filter.hm)},service.resetFilter=function(){service.time=null,service.text=null,service.user=null,service.geo=MapService.getCurrentExtentQuery().geo,service.textLimit=null},service}])}(),ol.interaction.Transform=function(options){options||(options={});var self=this;ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=options.features,this.layers_=options.layers?options.layers instanceof Array?options.layers:[options.layers]:null,this.set("translateFeature",options.translateFeature!==!1),this.set("translate",options.translate!==!1),this.set("stretch",options.stretch!==!1),this.set("scale",options.scale!==!1),this.set("rotate",options.rotate!==!1),this.on("propertychange",function(){this.drawSketch_()}),this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(feature){return self.style[(feature.get("handle")||"default")+(feature.get("constraint")||"")+(feature.get("option")||"")]}}),this.setDefaultStyle()},ol.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={"default":"auto",select:"pointer",translate:"move",rotate:"move",scale:"ne-resize",scale1:"nw-resize",scale2:"ne-resize",scale3:"nw-resize",scalev:"e-resize",scaleh1:"n-resize",scalev2:"e-resize",scaleh3:"n-resize"},ol.interaction.Transform.prototype.setMap=function(map){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Pointer.prototype.setMap.call(this,map),this.overlayLayer_.setMap(map),this.isTouch=/touch/.test(map.getViewport().className),this.setDefaultStyle()},ol.interaction.Transform.prototype.setActive=function(b){ol.interaction.Pointer.prototype.setActive.call(this,b),b&&this.select(null)},ol.interaction.Transform.prototype.setDefaultStyle=function(){function createStyle(img,stroke,fill){return[new ol.style.Style({image:img,stroke:stroke,fill:fill})]}var stroke=new ol.style.Stroke({color:[255,0,0,1],width:1}),strokedash=new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),fill0=new ol.style.Fill({color:[255,0,0,.01]}),fill=new ol.style.Fill({color:[255,255,255,.8]}),circle=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?12:6,points:15});circle.getAnchor()[0]=this.isTouch?-10:-5;var bigpt=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),smallpt=new ol.style.RegularShape({fill:fill,stroke:stroke,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});this.style={"default":createStyle(bigpt,strokedash,fill0),translate:createStyle(bigpt,stroke,fill),rotate:createStyle(circle,stroke,fill),rotate0:createStyle(bigpt,stroke,fill),scale:createStyle(bigpt,stroke,fill),scale1:createStyle(bigpt,stroke,fill),scale2:createStyle(bigpt,stroke,fill),scale3:createStyle(bigpt,stroke,fill),scalev:createStyle(smallpt,stroke,fill),scaleh1:createStyle(smallpt,stroke,fill),scalev2:createStyle(smallpt,stroke,fill),scaleh3:createStyle(smallpt,stroke,fill)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(style,olstyle){if(olstyle){olstyle instanceof Array?this.style[style]=olstyle:this.style[style]=[olstyle];for(var i=0;i<this.style[style].length;i++){var im=this.style[style][i].getImage();im&&("rotate"==style&&(im.getAnchor()[0]=-5),this.isTouch&&im.setScale(1.8));var tx=this.style[style][i].getText();tx&&("rotate"==style&&tx.setOffsetX(this.isTouch?14:7),this.isTouch&&tx.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(pixel){return this.getMap().forEachFeatureAtPixel(pixel,function(feature,layer){var found=!1;if(!layer){if(feature===this.bbox_)return!1;if(this.handles_.forEach(function(f){f===feature&&(found=!0)}),found)return{feature:feature,handle:feature.get("handle"),constraint:feature.get("constraint"),option:feature.get("option")}}if(this.layers_){for(var i=0;i<this.layers_.length;i++)if(this.layers_[i]===layer)return{feature:feature};return null}return this.features_?(this.features_.forEach(function(f){f===feature&&(found=!0)}),found?{feature:feature}:null):{feature:feature}},this)||{}},ol.interaction.Transform.prototype.drawSketch_=function(center){if(this.overlayLayer_.getSource().clear(),this.feature_)if(center===!0){if(!this.ispt_){this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"}));var ext=this.feature_.getGeometry().getExtent(),geom=ol.geom.Polygon.fromExtent(ext),f=this.bbox_=new ol.Feature(geom);this.overlayLayer_.getSource().addFeature(f)}}else{var ext=this.feature_.getGeometry().getExtent();if(this.ispt_){var p=this.getMap().getPixelFromCoordinate([ext[0],ext[1]]);ext=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([p[0]-10,p[1]-10]),this.getMap().getCoordinateFromPixel([p[0]+10,p[1]+10])])}var geom=ol.geom.Polygon.fromExtent(ext),f=this.bbox_=new ol.Feature(geom),features=[],g=geom.getCoordinates()[0];if(!this.ispt_){if(features.push(f),this.get("stretch")&&this.get("scale"))for(var i=0;i<g.length-1;i++)f=new ol.Feature({geometry:new ol.geom.Point([(g[i][0]+g[i+1][0])/2,(g[i][1]+g[i+1][1])/2]),handle:"scale",constraint:i%2?"h":"v",option:i}),features.push(f);if(this.get("scale"))for(var i=0;i<g.length-1;i++)f=new ol.Feature({geometry:new ol.geom.Point(g[i]),handle:"scale",option:i}),features.push(f);this.get("translate")&&!this.get("translateFeature")&&(f=new ol.Feature({geometry:new ol.geom.Point([(g[0][0]+g[2][0])/2,(g[0][1]+g[2][1])/2]),handle:"translate"}),features.push(f))}this.get("rotate")&&(f=new ol.Feature({geometry:new ol.geom.Point(g[3]),handle:"rotate"}),features.push(f)),this.overlayLayer_.getSource().addFeatures(features)}},ol.interaction.Transform.prototype.select=function(feature){this.feature_=feature,this.ispt_=!!this.feature_&&"Point"==this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_})},ol.interaction.Transform.prototype.handleDownEvent_=function(evt){var sel=this.getFeatureAtPixel_(evt.pixel),feature=sel.feature;return this.feature_&&this.feature_==feature&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(sel.handle="translate"),sel.handle?(this.mode_=sel.handle,this.opt_=sel.option,this.constraint_=sel.constraint,this.coordinate_=evt.coordinate,this.pixel_=evt.pixel,this.geom_=this.feature_.getGeometry().clone(),this.extent_=ol.geom.Polygon.fromExtent(this.geom_.getExtent()).getCoordinates()[0],this.center_=ol.extent.getCenter(this.geom_.getExtent()),this.angle_=Math.atan2(this.center_[1]-evt.coordinate[1],this.center_[0]-evt.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.feature_,pixel:evt.pixel,coordinate:evt.coordinate}),!0):(this.feature_=feature,this.ispt_=!!this.feature_&&"Point"==this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_,pixel:evt.pixel,coordinate:evt.coordinate}),!1)},ol.interaction.Transform.prototype.handleDragEvent_=function(evt){switch(this.mode_){case"rotate":var a=Math.atan2(this.center_[1]-evt.coordinate[1],this.center_[0]-evt.coordinate[0]);if(!this.ispt){var geometry=this.geom_.clone();geometry.rotate(a-this.angle_,this.center_),this.feature_.setGeometry(geometry)}this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.feature_,angle:a-this.angle_,pixel:evt.pixel,coordinate:evt.coordinate});break;case"translate":var deltaX=evt.coordinate[0]-this.coordinate_[0],deltaY=evt.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(deltaX,deltaY),this.handles_.forEach(function(f){f.getGeometry().translate(deltaX,deltaY)}),this.coordinate_=evt.coordinate,this.dispatchEvent({type:"translating",feature:this.feature_,delta:[deltaX,deltaY],pixel:evt.pixel,coordinate:evt.coordinate});break;case"scale":var center=this.center_;(evt.originalEvent.metaKey||evt.originalEvent.ctrlKey)&&(center=this.extent_[(Number(this.opt_)+2)%4]);var scx=(evt.coordinate[0]-center[0])/(this.coordinate_[0]-center[0]),scy=(evt.coordinate[1]-center[1])/(this.coordinate_[1]-center[1]);this.constraint_?"h"==this.constraint_?scx=1:scy=1:evt.originalEvent.shiftKey&&(scx=scy=Math.min(scx,scy));var geometry=this.geom_.clone();geometry.applyTransform(function(g1,g2,dim){if(dim<2)return g2;for(i=0;i<g1.length;i+=dim)1!=scx&&(g2[i]=center[0]+(g1[i]-center[0])*scx),1!=scy&&(g2[i+1]=center[1]+(g1[i+1]-center[1])*scy);return g2}),this.feature_.setGeometry(geometry),this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.feature_,scale:[scx,scy],pixel:evt.pixel,coordinate:evt.coordinate})}},ol.interaction.Transform.prototype.handleMoveEvent_=function(evt){if(!this.mode_){var sel=(evt.map,this.getFeatureAtPixel_(evt.pixel)),element=evt.map.getTargetElement();if(sel.feature){var c=sel.handle?this.Cursors[(sel.handle||"default")+(sel.constraint||"")+(sel.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=element.style.cursor),element.style.cursor=c}else void 0!==this.previousCursor_&&(element.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(evt){return this.dispatchEvent({type:this.mode_+"end",feature:this.feature_,oldgeom:this.geom_}),this.drawSketch_(),this.mode_=null,!1},ol.filter={},ol.filter.Base=function(options){ol.Object.call(this),options&&options.active===!1?this.set("active",!1):this.set("active",!0)},ol.inherits(ol.filter.Base,ol.Object),ol.filter.Base.prototype.setActive=function(b){this.set("active",b===!0)},ol.filter.Base.prototype.getActive=function(b){return this.set("active")},ol.filter.Base.prototype.addFilter_=function(filter){this.filters_||(this.filters_=[]),this.filters_.push(filter),filter.precompose&&this.on("precompose",function(e){filter.get("active")&&filter.precompose(e)},this),filter.postcompose&&this.on("postcompose",function(e){filter.get("active")&&filter.postcompose(e)},this),filter.on("propertychange",function(){this.renderSync?this.renderSync():this.changed()},this)},ol.Map.prototype.addFilter=function(filter){ol.filter.Base.prototype.addFilter_.call(this,filter)},ol.Map.prototype.getFilters=function(){return this.filters_},ol.layer.Base.prototype.addFilter=function(filter){ol.filter.Base.prototype.addFilter_.call(this,filter)},ol.layer.Base.prototype.getFilters=function(){return this.filters_},ol.filter.Mask=function(options){if(options=options||{},ol.filter.Base.call(this,options),options.feature)switch(options.feature.getGeometry().getType()){case"Polygon":case"MultiPolygon":this.feature_=options.feature}this.set("inner",options.inner),this.fillColor_=options.fill?ol.color.asString(options.fill.getColor())||"rgba(0,0,0,0.2)":"rgba(0,0,0,0.2)"},ol.inherits(ol.filter.Mask,ol.filter.Base),ol.filter.Mask.prototype.drawFeaturePath_=function(e,out){function tr(pt){return[(pt[0]*m[0]+pt[1]*m[1]+m[4])*ratio,(pt[0]*m[2]+pt[1]*m[3]+m[5])*ratio]}var ctx=e.context,canvas=ctx.canvas,ratio=e.frameState.pixelRatio,m=e.frameState.coordinateToPixelTransform;m||(m=e.frameState.coordinateToPixelMatrix,tr=function(pt){return[(pt[0]*m[0]+pt[1]*m[1]+m[12])*ratio,(pt[0]*m[4]+pt[1]*m[5]+m[13])*ratio]});var ll=this.feature_.getGeometry().getCoordinates();"Polygon"==this.feature_.getGeometry().getType()&&(ll=[ll]),ctx.beginPath(),out&&(ctx.moveTo(0,0),ctx.lineTo(canvas.width,0),ctx.lineTo(canvas.width,canvas.height),ctx.lineTo(0,canvas.height),ctx.lineTo(0,0));for(var l=0;l<ll.length;l++)for(var c=ll[l],i=0;i<c.length;i++){var pt=tr(c[i][0]);ctx.moveTo(pt[0],pt[1]);for(var j=1;j<c[i].length;j++)pt=tr(c[i][j]),ctx.lineTo(pt[0],pt[1])}},ol.filter.Mask.prototype.postcompose=function(e){if(this.feature_){var ctx=e.context;ctx.save(),this.drawFeaturePath_(e,!this.get("inner")),ctx.fillStyle=this.fillColor_,ctx.fill("evenodd"),ctx.restore()}},angular.module("templates-components",["components/datepicker/datepicker.tpl.html","components/geospatialFilter/geospatialFilter.tpl.html","components/heatmap/heatmap.tpl.html","components/histogram/histogram.tpl.html","components/keyword/keyword.tpl.html","components/keywordInput/keywordInput.tpl.html","components/resetButton/resetButton.tpl.html","components/toolbarSearch/toolbarSearchField.tpl.html","components/tweetlist/counter.tpl.html","components/tweetlist/tweetlist.tpl.html","components/tweetlist/tweetPanel.tpl.html"]),angular.module("components/datepicker/datepicker.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/datepicker/datepicker.tpl.html",'<div class="col-md-12 padding-search">\n        <div class="form-horizontal">\n            <div class="row">\n                <label class="control-label col-xs-2">From</label>\n                <div class="col-xs-4 datepicker-wrapper">\n                    <p class="input-group">\n                        <input type="text" class="form-control input-sm" uib-datepicker-popup ng-model="datepickerStartDate" is-open="startDate.opened"\n                            show-button-bar="false" datepicker-options="dateOptions" ng-required="true"\n                            ng-model-options="{timezone: \'UTC\'}" ng-change="onChangeDatepicker()" readonly/>\n                        <span class="input-group-btn">\n                            <button type="button" class="btn btn-default btn-sm" ng-click="openStartDate()"><i class="glyphicon glyphicon-calendar"></i></button>\n                        </span>\n                    </p>\n                </div>\n                <label class="control-label col-xs-1">To</label>\n                <div class="col-xs-4 datepicker-wrapper">\n                    <p class="input-group">\n                        <input type="text" class="form-control input-sm" uib-datepicker-popup ng-model="datepickerEndDate" is-open="endDate.opened"\n                            show-button-bar="false" datepicker-options="dateOptions" ng-required="true"\n                            ng-model-options="{timezone: \'UTC\'}" ng-change="onChangeDatepicker()" readonly />\n                        <span class="input-group-btn">\n                            <button type="button" class="btn btn-default btn-sm" ng-click="openEndDate()"><i class="glyphicon glyphicon-calendar"></i></button>\n                        </span>\n                    </p>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="col-md-12 padding-search">\n        <div class="row">\n          <div class="date-picker-input">\n              <form ng-submit="onSubmitDateText()">\n                    <div class="form-group">\n                        <div class="col-xs-12">\n                            <div class="row searchtext" ng-class="{\'searchtext-focus\': focus}">\n                                <span class="input-group searchinputfield" id="searchinput">\n                                    <input class="md-input input-sm" type="text" ng-keyup="onKeyPress($event)" ng-model="dateString" ng-blur="focus=false" ng-focus="focus=true">\n                                    <span ng-click="doSearch()" class="input-group-addon border-search">\n                                        <i class="glyphicon glyphicon-search"></i>\n                                    </span>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n              </form>\n\n          </div>\n        </div>\n    </div>\n')}]),angular.module("components/geospatialFilter/geospatialFilter.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/geospatialFilter/geospatialFilter.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="input-group row searchtext searchinputfield" id="geospatialfilterinput" ng-class="{\'searchtext-focus\': focus}">\n        <input ng-model="filter.geo" ng-keypress="onKeyPress($event)" ng-click="onFocus()"\n        class="md-input" type="text" ng-keyup="onKeyPress($event)" ng-blur="focus=false" ng-focus="focus=true">\n        <span ng-click="doSearch()" class="input-group-addon border-search">\n            <i class="glyphicon glyphicon-search"></i>\n        </span>\n    </div>\n</div>\n')}]),angular.module("components/heatmap/heatmap.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/heatmap/heatmap.tpl.html",'<!-- the ol3 map -->\n<div class="map heatmap" id="map"></div>\n')}]),angular.module("components/histogram/histogram.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/histogram/histogram.tpl.html",'<!-- <time-histogram barId="inbar"></time-histogram> -->\n<div class="col-md-12 component-padding">\n    <div class="bar-graph" id="{{barId}}" style="min-width: 400px" ng-class="{disabled: slider.options.disabled}"></div>\n    <rzslider rz-slider-model="slider.minValue" rz-slider-high="slider.maxValue" rz-slider-options="slider.options"></rzslider>\n</div>\n')}]),angular.module("components/keyword/keyword.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/keyword/keyword.tpl.html",'<div class="md-chips">\n    <span>{{tag}}</span>\n    <button ng-click="removefn({keyword: tag})" ng-if="removeTag">&times;</button>\n</div>\n')}]),angular.module("components/keywordInput/keywordInput.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/keywordInput/keywordInput.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="row searchtext" ng-class="{\'searchtext-focus\': focus}">\n        <keyword removefn="removeKeyWord(keyword)" ng-repeat="keywordFilter in filterArray track by $index" remove="true" tag="{{keywordFilter}}"></keyword>\n        <span class="input-group searchinputfield" id="searchinput">\n             <input class="md-input" type="text" placeholder="{{placeholder}}" ng-keyup="onKeyPress($event)"\n              ng-model="textSearchInput.value" ng-blur="focus=false" ng-focus="focus=true">\n            <span ng-click="doSearch()" class="input-group-addon border-search">\n                <i class="glyphicon glyphicon-search"></i>\n            </span>\n        </span>\n    </div>\n</div>\n<div class="col-xs-12 padding-search" style="padding-top: 10px; padding-bottom: 6px;">\n    <div class="btn-group pull-left">\n        <label class="btn btn-default btn-xs btn-tag" ng-class="{active: tagSwitch.value}">\n            <input type="checkbox" autocomplete="off" ng-model="tagSwitch.value" ng-change="toggleSuggestKeywords()" ng-disabled="tagSwitch.disable"> Suggestions\n        </label>\n    </div>\n    <keyword  ng-repeat="keyword in suggestedKeywords" class="keyword-min"\n        ng-click="addSuggestedKeywordToSearchInput(keyword.value)" remove="false" tag="{{keyword.value}}"></keyword>\n</div>\n')}]),angular.module("components/resetButton/resetButton.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/resetButton/resetButton.tpl.html",'<div class="row">\n    <div class="col-sm-4">\n        <button class="btn btn-primary reset-btn" id="exportbtn"\n            title="RESET" type="button" ng-click="reset()">RESET</button>\n        <span class="searchbtn"></span>\n    </div>\n</div>\n')}]),angular.module("components/toolbarSearch/toolbarSearchField.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/toolbarSearch/toolbarSearchField.tpl.html",'<div class="col-xs-12 padding-search">\n    <div class="row toolbarsearch" ng-class="{\'searchtext-focus\': focus}">\n        <keyword removefn="removeKeyWord(keyword)" ng-repeat="keywordFilter in filterArray track by $index" remove="true" tag="{{keywordFilter}}"></keyword>\n        <span class="input-group searchinputfield" id="searchinput">\n            <input class="md-input" type="text" placeholder="Enter keyword" ng-keyup="onKeyPress($event)"\n              ng-model="textSearchInput.value" ng-blur="focus=false" ng-focus="focus=true">\n            <span ng-click="doSearch()" class="input-group-addon border-search">\n                <i class="glyphicon glyphicon-search"></i>\n            </span>\n        </span>\n\n     </div>\n</div>\n<div class="col-xs-12 padding-search" style="padding-top: 10px; padding-bottom: 6px;">\n    <div class="btn-group pull-left">\n        <label class="btn btn-default btn-xs btn-tag" ng-class="{active: tagSwitch.value}">\n            <input type="checkbox" autocomplete="off" ng-model="tagSwitch.value" ng-change="toggleSuggestKeywords()" ng-disabled="tagSwitch.disable"> Suggestions\n        </label>\n    </div>\n    <keyword  ng-repeat="keyword in suggestedKeywords" class="keyword-min"\n        ng-click="addSuggestedKeywordToSearchInput(keyword.value)" remove="false" tag="{{keyword.value}}"></keyword>\n</div>\n')}]),angular.module("components/tweetlist/counter.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/counter.tpl.html",'<div class="count-padding">\n    <p ng-show="counter">Results for keyword: {{counter}}</p>\n</div>\n')}]),angular.module("components/tweetlist/tweetlist.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/tweetlist.tpl.html",'<div class="row">\n    <div style="max-height: {{availableHeight}}px;" class="tweet-component">\n        <li ng-repeat="tweet in tweetList" class="tweet" ng-mouseleave="removeAllfeatures()"\n            ng-mouseenter="selectTweet(tweet)">\n          <div class="list-item-text">\n            <h3>@{{tweet.user_name}}</h3>\n            <h4>{{tweet.text}}</h4>\n            <p>{{tweet.created_at | date:\'medium\'}}</p>\n          </div>\n        </li>\n        <div ng-if="!tweetList.length && tweetList.exist" class="no-info">\n            No Tweets Available\n        </div>\n    </div>\n    <tweet-counter></tweet-counter>\n</div>\n')}]),angular.module("components/tweetlist/tweetPanel.tpl.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("components/tweetlist/tweetPanel.tpl.html",'<dl class="dl-horizontal list-group tweet-detail-panel" ng-if="!panelEmpty">\n<div class="list-group-item">\n    <dt>Id</dt>\n    <dd >{{selectedTweet.id}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>Created at</dt>\n    <dd>{{selectedTweet.created_at}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>Coord</dt>\n    <dd>{{selectedTweet.coord}}</dd>\n</div>\n<div class="list-group-item">\n    <dt>User Name</dt>\n    <dd>{{selectedTweet.user_name}}</dd>\n</div>\n</dl>\n<div class="no-info" ng-if="panelEmpty">Tweet details</div>\n')}]);